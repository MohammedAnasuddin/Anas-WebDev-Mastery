# Working with Database

> `TIP`
> 
> Configure all the services inside a folder named `config`

## Mongoose

Most used to medium to connect with mongoDB

### Connecting with Database

1. Create a async function

2. use `await mongoose.connect(uri)` 
   
   1. > UTI will point to a cluster , to point a database append `/db_name` to the URI
   
   > `WARNING`
   > 
   > Try not to include symbols in password, These symbols manipulates logic of Encoding URI and DB wont be connected. 
   > 
   > ### If you have to use symbols
   > 
   > A connection string is essentially a URL, and it follows the standard URL format:
   > 
   > `protocol://<username>:<password>@<hostname>:<port>/<database>?<options>`
   > 
   > Characters like `:`, `@`, `/`, and `?` are used as delimiters to separate the different parts of the string. When the driver sees one of these characters in your password, it can get confused and parse the string incorrectly.
   > 
   > The `@` symbol is the most common culprit because it's frequently used in email addresses, which people often use for passwords. However, other characters can also cause problems.
   > 
   > To fix this, you need to URL-encode the special characters in your password. The `@` character should be replaced with `%40`.
   > 
   > Here is a list of common characters that you should always percent-encode if they appear in your username or password:
   > 
   > | Character | Name          | Encoded Value |
   > | --------- | ------------- | ------------- |
   > | `@`       | At Symbol     | `%40`         |
   > | `:`       | Colon         | `%3A`         |
   > | `/`       | Forward Slash | `%2F`         |
   > | `?`       | Question Mark | `%3F`         |
   > | `#`       | Hash / Pound  | `%23`         |
   > | `[`       | Left Bracket  | `%5B`         |
   > | `]`       | Right Bracket | `%5D`         |
   > | `&`       | Ampersand     | `%26`         |
   > | `=`       | Equals Sign   | `%3D`         |
   > | `+`       | Plus Sign     | `%2B`         |
   > |           | Space         | `%20`         |

3. this async function returns a promise , use .`then()` and `.catch()` 

4. require the file in which `async` function in the server started file (`app.js` or `server.js`) in order to establish connection ass soon as server starts
   
   This creates a problem the server gets starts listening first and then Db gets connected which is not desirable
   
   > **The Fix**
   > 
   > 1. export the async Function
   > 
   >     2. In the server starter get the async function and in the `.then` of this     function listen to the server.  
   > 
   > This enables server to listen only after DB ha connected.
   
   ```js
   // config/Databse.js
   const mongoose = require("mongoose");
   
   async function connectDB(){
       await mongoose.connect(URI)
   }
   
   module.exports = connectDB; 
   ```

```js
// server.js
const express = require("express")
const connectDB = require("./config/Database")
const app = express()


connectDB()
.then(
    ()=>{
    console.log("DB Connected")
    app.listen(5000, ()=>{
        console.log("Server Successfully listening on PORT 5000")
    });
    }    
)
.catch(
    (err) => {
        console.log(err);
    }
)
```

## Creating Schema and Model

1. Create a folder named `models`

2. For every collection , create `JS` file.

3. use `const userSchema = new mongooe.schema()` to create the schema

4. this takes an object make sure *keys are camelCase* with no underscores

5. Each property of this object will hold an Object as an value
   
   1. This object will contain a property of `type` which stores the data type of the property.

6. Now use `const Model = mongoose.model("name", schema)` to create a model 

7. Export this model

```js
// models/User.js

const mongoose = require("mongoose")

const userSchema = new mongoose.Schema({
    firstName: {
        type:String
    },
    lastName: {
        type:String
    },
    gender: {
        type:String
    },
    mail: {
        type:String
    },
})

const User = mongoose.model("User",userSchema)
module.exports = User;
```

## Writing Data into Collection with Routes

We create a `POST` API which adds the `Document` to the Instance of the model created above section.(User)

1. Create a new `POST` API with the required data \
   
   1. > `NOTE`
      > 
      > Route Handle should be `aync`

2. Require the Model

3. Create the instance of the model 
   
   1. `const model_instance = new Model(data)`

4. Now use `await Model_instance.save()`  

5. Send a response

> `_id` and `__v`
> 
> these fields are auto injected into a document by mongoDB to uniquely identify the document. *You can modify but don't do it*
> 
> `__v` are the version control of the document.



> `TIP`
> 
> Always wrap DB operations in `try-catch`



### Writing Dynamic(user_input) data to the Database
